
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mickaelsasl.github.io/term/cours/AMSER/AMSER2/exo/">
      
      <link rel="icon" href="../../../../images/sasl.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.5">
    
    
      
        <title>**AMSER2 - Gestion des processus et des ressources par un système d’exploitation** - NSI Terminale</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
    
    
      <link rel="stylesheet" href="../../../../overrides/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="light-green">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#amser2-gestion-des-processus-et-des-ressources-par-un-systeme-dexploitation" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../../../.." title="NSI Terminale" class="md-header__button md-logo" aria-label="NSI Terminale" data-md-component="logo">
      
  <img src="../../../../logo_sasl.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NSI Terminale
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              **AMSER2 -  Gestion des processus et des ressources par un système d’exploitation**
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="light-green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
      </form>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/mickaelSASL/term" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Onglets" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Accueil
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="/cours" class="md-tabs__link">
      Cours
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="/EP" class="md-tabs__link">
      Epreuves Pratiques
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="/GO" class="md-tabs__link">
      Grand Oral
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="/P" class="md-tabs__link">
      Projets
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="NSI Terminale" class="md-nav__button md-logo" aria-label="NSI Terminale" data-md-component="logo">
      
  <img src="../../../../logo_sasl.png" alt="logo">

    </a>
    NSI Terminale
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mickaelSASL/term" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Accueil
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/cours" class="md-nav__link">
        Cours
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/EP" class="md-nav__link">
        Epreuves Pratiques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/GO" class="md-nav__link">
        Grand Oral
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/P" class="md-nav__link">
        Projets
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/mickaelSASL/term/edit/master/docs/cours/AMSER/AMSER2/exo.md" title="Editer cette page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="amser2-gestion-des-processus-et-des-ressources-par-un-systeme-dexploitation"><strong>AMSER2 -  Gestion des processus et des ressources par un système d’exploitation</strong></h1>
<h2 id="illustration-de-linterblocage-en-python">Illustration de l'interblocage en Python</h2>
<h3 id="commencons-par-une-simple-fonction-qui-doit-incrementer-100-fois-une-variale-compteur">Commençons par une simple fonction qui doit incrémenter 100 fois une variale compteur :</h3>
<div class="highlight"><span class="filename">🐍 Script Python</span><pre><span></span><code><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="n">compteur</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Variable globale</span>
<span class="n">limite</span> <span class="o">=</span> <span class="mi">100</span>

<span class="k">def</span> <span class="nf">calcul</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">compteur</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">limite</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">compteur</span>
        <span class="c1"># simule un traitement nécessitant des calculs</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.000000001</span><span class="p">)</span>
        <span class="n">compteur</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">compteur</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">calcul</span><span class="p">()</span>
<span class="n">compteur</span>

<span class="mi">100</span>
</code></pre></div>
<p>Sans surprises, la valeur de la variable compteur vaut 100. Vous remarquerez la manière dont l'incrémentation du compteur a été volontairement complexifié. La raison va apparaître maintenant car nous allons maintenant lancer 4 processus légers (appelés threads) qui vont tous les 4 exécuter la fonction calcul.</p>
<p>On pourrait imaginer que puisque calcul est exécuté 4 fois le résultat final sera 400. En réalité, il n'en est rien :</p>
<div class="highlight"><span class="filename">🐍 Script Python</span><pre><span></span><code><span class="n">compteur</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span> <span class="c1"># Lance en parallèle 4 exécutions dd calcul</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">calcul</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>      <span class="c1"># Lance calcul dans un processus léger à part.</span>
<span class="n">compteur</span>

<span class="mi">149</span>
</code></pre></div>
<h3 id="threads-are-evil-dont-use-them">Threads are evil, don't use them !</h3>
<p>En réévaluant plusieurs fois l'exécution du calcul parallèle, on s'aperçoit que</p>
<ol>
<li>le résultat n'est pas 400 !</li>
<li>d'une exécution à l'autre le résultat est différent !!</li>
</ol>
<p>Voila qui est très perturbant : Un même programme - très simple - exécuté plusieurs fois qui ne donne pas le même résultat. Bienvenue dans le monde infernal des thread. Cela explique la réticence de certains à les utiliser : <strong>Threads are evil, don't use them !</strong> lit-on souvent sur les forums de développeurs...</p>
<p>Et pourtant ils sont nécessaires à bon nombre de tâches. Sans threads, pas de serveurs webs capables d'encaisser des millions de requêtes à la seconde !</p>
<h3 id="explication">Explication</h3>
<p>Il n'y a rien d'illogique ou d'aléatoire dans le fonctionnement de notre programme. Il faut simplement habituer notre esprit à l'exécution en parallèle :</p>
<ul>
<li>
<p>quatre processus (appelons les P1, P2, P3 et P4) exécutent la fonction calcul simultanément. Celle-ci utilise une variable globale qui sera donc modifiée par chacun de ces processus et une variable locale temp qui sera spécifique à chacun de nos processus. Nous la désignerons par temp(P1) temp(P2) etc... Un scénario possible est le suivant : Imaginons au départ que compteur vaille 10.</p>
</li>
<li>
<p>P1 sauvegarde compteur dans temp(P1) --&gt; temp(P1) vaut 10</p>
</li>
<li>
<p>P2 sauvegarde compteur dans temp(P2) --&gt; temp(P2) vaut 10</p>
</li>
<li>P3 sauvegarde compteur dans temp(P3) --&gt; temp(P3) vaut 10</li>
<li>P1 et P2 incrémentent temp et sauvegardent la réponse dans compteur --&gt; compteur vaut 11</li>
<li>P4 sauvegarde compteur dans temp(P4) --&gt; temp(P4) vaut 11</li>
<li>P3 et P4 incrémentent temp et sauvegardent la réponse dans compteur</li>
</ul>
<p>au final, compteur a été incrémenté 4 fois mais de fait de l'exécution en parallèle compteur ne vaut pas 14 mais 12 ! cela explique que notre compteur au final ne vaut pas 400 car sa sauvegarde dans des variables temporaires fait que la plupart des incrémentations ne sont pas prises en compte.</p>
<p>Quand au résultat apparemment aléatoire, il est du au scénario d'exécution. j'en ai cité un au hasard mais bien d'autres sont possibles qui mèneraient à des résultats différents. Un problème avec les threads est que l'on ne maîtrise pas du tout l'ordre dans lequel ils sont exécutés. Une fois lancés, chacun vit sa vie...</p>
<p>Vous voila j'espère convaincus que les threads sont réellement diaboliques !</p>
<h3 id="fiabiliser-lalgorithme">Fiabiliser l'algorithme</h3>
<p>Il est possible d'éviter que nos threads interfèrent les uns avec les autres : il suffit de s'assurer que la partie centrale qui incrémente notre compteur ne soit pas exécutée par 2 threads à la fois. Pour ce faire, on introduit la notion de <strong>verrou</strong>: un <strong>verrou</strong> peut être vu comme un témoin qui passe de thread en thread. Seul celui qui possède ce témoin peut exécuter l'incrémentation du compteur, les autres doivent attendre leur tour.</p>
<p>Nous allons donc légèrement modifier notre fonction calcul afin d'utiliser la partie critique de notre algorithme, à savoir l'incrémentation du compteur. Le module threading propose un objet Lock() destiné à cette tâche. Deux méthodes seront utilisées ici:</p>
<p>verrou.acquire() : attend que le vérrou soit libéré pour se l'accaparer et l'activer
verrou.release() : libère le verrou
from threading import Lock
verrou = Lock()</p>
<p>def calcul1():
    global compteur
    for c in range(limite):
        verrou.acquire()
        # Début de la section critique
        temp = compteur
        sleep(0.000000001)
        compteur = temp + 1
        # Fin de la section critique
        verrou.release()
Grâce à ce système, il est impossible que la partie critique du code soit exécutée simultanément par deux threads. On est donc assuré qu'il n'y aura pas d'interaction entre les threads.</p>
<p>Au final on constate bien que le le compteur vaut 400, ce qui est le résultat attendu.</p>
<p>En mémorisant les threads créés, on constate qu'ils se sont tous bien terminés.</p>
<p>compteur = 0</p>
<p>mes_threads = []
for i in range(4):
    p = Thread(target = calcul1)
    p.start()
    mes_threads.append(p)
compteur
400
mes_threads[0]
<Thread(Thread-20, stopped 140507816642304)>
mes_threads[0].is_alive()
False
Et l'interblocage ?
La situation d'interblocage ne peut pas arriver dans le scénario précédent car nous n'avons qu'un verrou donc une seule resssource convoitée par 4 threads : celle-ci va passer de threads en threads sans conflits. Pour faire apparaître l'interblocage, nous avons besoin de plusieurs verrous afin de créer une attente circulaire.</p>
<p>Nous allons donc créer 4 verrous : V0 V1 V2 et V3. La fonction calcul2 va utiliser deux verrous.</p>
<p>Le Thread P0 va donc réserver V0 puis V1
Le Thread P1 va donc réserver V1 puis V2
Le Thread P2 va donc réserver V2 puis V3
Le Thread P3 va donc réserver V3 puis V0
ces verrous seront libérés à la fin... sauf si le thread est en attente pour acquerir un verrou ! Et voilà une situation d'interblocage qui s'annonce...</p>
<p>def calcul2(verrou1, verrou2):
    global compteur
    for c in range(limite):
        verrou1.acquire()
        # Début de la section critique 1 
        temp = compteur
        sleep(0.000000001)
        # Début de la section critique 2
        verrou2.acquire()
        compteur = temp + 1
        # Début de la section critique 2
        verrou2.release()
        # Fin de la section critique 1
        verrou1.release()
compteur = 0</p>
<h1 id="on-cree-4-verrous-dans-un-tableau">On crée 4 verrous dans un tableau</h1>
<p>verrous = [Lock() for i in range(4)] 
mes_threads = []
for i in range(4):
    p = Thread(target = calcul2, args = [verrous[i], verrous[(i+1)%4]])
    p.start()
    mes_threads.append(p)
compteur
1
mes_threads
[<Thread(Thread-24, started 140507833427712)>,
 <Thread(Thread-25, started 140507816642304)>,
 <Thread(Thread-26, started 140507841820416)>,
 <Thread(Thread-27, started 140507825035008)>]
On constate que tous les threads sont actifs et que le compteur ne s'incrémente pas. Nous sommes en situation d'interblocage !</p>
<p>Il n'y a pas d'autre choix que de tuer le processus Python et les threads afférents.</p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Retour en haut de la page
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.tracking", "navigation.top", "header.autohide", "toc.integrate"], "search": "../../../../assets/javascripts/workers/search.bd0b6b67.min.js", "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.config.lang": "fr", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Rechercher", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version.title": "S\u00e9lectionner la version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.467223ff.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../../xtra/js/config.js"></script>
      
    
  </body>
</html>